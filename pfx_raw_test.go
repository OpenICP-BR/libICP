package libICP

import (
	"testing"

	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
)

func Test_decrypt_PbeWithSHAAnd3KeyTripleDES_CBC(t *testing.T) {
	ans, err := decrypt_PbeWithSHAAnd3KeyTripleDES_CBC(conv_password("beltrano"), 2048, beltrano_cert_salt, beltrano_cert_enc)
	require.Nil(t, err)
	assert.Equal(t, beltrano_cert_dec, ans)
}

func Test_encrypt_PbeWithSHAAnd3KeyTripleDES_CBC(t *testing.T) {
	ans, err := encrypt_PbeWithSHAAnd3KeyTripleDES_CBC(conv_password("beltrano"), 2048, beltrano_cert_salt, beltrano_cert_dec)
	require.Nil(t, err)
	assert.Equal(t, beltrano_cert_enc, ans)
}

func Test_pfx_raw_Marshal(t *testing.T) {
	pack := certificate_pack{}
	key, _, _ := new_rsa_key(2048)
	dat, cerr := marshal_pfx("beltrano", pack, key)
	assert.Nil(t, cerr)
	assert.NotNil(t, dat)
}

var beltrano_cert_salt []byte = from_hex("676F447E2F72BA4D")
var beltrano_cert_enc []byte = from_hex("AC7B8B835A6EFE1AA7E58148B2708239A5AFED975375A972DF9CCD5F62B81F4B778E15F240AEE9A23A780F346A9B407EE3F44665AD0A1192DBE47EF431B107CC504E2FD2706C1E80E2EB3415E5C76CC38548F78DD1576E0415F28459DD26A5FFEA9A5A0820B81421CD6EF4017BB8789E4D04A4BD9A645676AAA8893AC5A62C0DFB210C1D20B7104220F2E27942EAFEB8D431262A44F430CD73EFF5283583D6653F86404EBB4007E892A4B93EB33F8205AEC6CC8DCCC26C75EB256EB8F87C40FE6CB8B02E4D6759E2F3B52ABBF670233157972536EB8B1A1206D26467A80DFB3DDCAA1B81E5F8154C1C88991522A2EFCF977D8AA6401557B1C19DD9D7A53F44D3F2821AA16F3284EF0F4338478239FAF86FCF6AE45D0CFFE82BB1A92AD5806D98F8F53A7EFF890A7D0A10F9C97A79D4F0018EDA312EED361101457DC20A874296981AE23C5022BA405B5D204D709C84BE1CB2EE4A4F9488A72DD6807A6E4ED4600B939CDB975ADD5A789A5F6946542E75A1C1634B46F11C84AC8AB8132CDE45CFE2DB9B0D2767711BE1E6BA7C42F5D66BA7E91D512138F4ED3C2B1B9E62AB54B1589EA043F7AE3552ACF8C7657655DF7FFC9FBCB0627F713C34C303E5E31C59CB38642A375906BD8D99D6B6077EA589BC7E59540BD63287FF498A29533E4926F378DFD44DA3064E28BA89FF324F830866A99D38103A783D83FB09544E08D9F7C5D94FBBFFFE6DA5F9ACAF85C3DB2802F4798D7AB5A69CCE43EEB6011849AC9FB88A1974FBB020F5127059A5DF01CE540E2558EC7157B07E46DC955C440A5DAF2109DA3D35E34A16D0562121BA9B908ED223CB5A16D90C801334CDF5E9A063FF40D502918E999BE963418FBD62FB81719003F177249E9B54F6C0D8E8EB475D642D4794DC49A2F4D6BA3C2DDE90AF438E9F214E4FAD031E308A1D5BA4377BEB08F59ACC6185E7B354F41E54E8ED4DA48C9BA814222167DFB3B6EC0EB46E648765E9FFD9F63E0420F048917F0CF5E93274DA3C469B9CC8E4BE15AF3B49A43B93BC8501A96BC33DFDA972FD4028B9337398BCB90A85CDA1EB9ED759D571298AA524D323A653CB5FECD2ACAFD4E2EF48D9E026A0D20261FB2E61778CC5203A8FC24D77DA69D56DBD386AC80286F52E1BE659C350C1C95C17DB5A5A00EEE7AE00B4C3ABFF2AE4E0590A8F1F105B1529CE266614B23827707EF8D445D7587213A91057DE35A06DD7A1E7C0B3467A70BC0B2079B933DC6789CB1D858DCD95E60E168FFE1D9B3F141A92986BEC154600EDE59D8B62189ACF5F83321B183DF7C7B7A203474E79C8CD0A5AB3AA848F97861037B69E42023F3CED744E128CB1E4DD5F06930D7ACCD13FC75BD286DF509C51C0E9620D5883B5EFF2D16109477E0DD9FF8B9933674BD37ABB4BADCB673AB02A01CFD2FD77CECAC53DC0EA232ADC87BF52084B2D87F11D5B52568F1F79E513C812565D04F812186C5197F6E07344BA796E2987757CFDF4AAD9FBAF098D7BABF0642DFC43C24B0A5A9327FC76837C06652D034507E095E6963767413D515A0C1C45EB5DB59A69A71040BA478C5220ABE1CDC01984BBA0E28FCB72926867526D482B5D779A1C53AE3781A799BE69CE2E32B3FBA9015E93226409451B79FD45D02EB201BB58F2814D7BCD46C0596EA2FE68DD68F59ED4C05F7C82606F2BD445B3CB3E9D93EC03FD6111823125DF732DF90FD9A1E775185D755B79DAA5748F")
var beltrano_cert_dec []byte = from_hex("308204BD020100300D06092A864886F70D0101010500048204A7308204A30201000282010100A3C8E4F6D0A3307F828AC6349D10007411FE0788F47C4F177E14C949E40C449AA50DA5A47A2CE6E5178E80430DFCD2B84C44900BB897E21887D592930C47672DC719E1D1D70FD3064D3F8879642A0B31B9C076A919B0AF1EBBAA26D8D214294CDE045B8BC500A8AA7A2BE79E68399C57DCC37899F29D0B946E8BD4F3E775829BFFEBC2158E66697CE03DE413E2D280EF7F1C19DA7C7ACED419967D4261B67F830E3968472FFD899C4C1E8512BD5717A4663E8E94D16FEFBF5B48B5C7060E146AEB93BD50CE204C6240F5E81567CCB24C55858B3379A46867BAD93228314F539F267B5E5E0DE3944E5D3948F5F3D5241594D2E0BE3EC5C0D4268928418971CCAD02030100010282010065FB460E24D527F28D6F29814336DE81675E9C847B6F17B4520E5153900ACF80D73B0B23C1EB498DE64015BF2AEB7CADC2D78235BA27E06153DAF91C54ADF521FCF231B8FE475D27745C15F7381631C83198148AB07362672985061145A5C61D95B472E831AF7A56442228636B144C342D430D4A1656110AC8568B2F9FB47CB0F4C992E11015A10A454E16007B4C94369B920958A0139E2A388D8E35B25F61756C4B6A8E16EBEDB41D1332A2AFF561ECA659F1314C1897437F3E6F047D980678259E95D14918BCD715C765E701F9B158B08324F98BCD459395FEC1608605118FDC031FE1F603D68F2F5FBE4876328735F46F2CDA18649D613004FEF6A2112C6102818100D5C955FD8AAE12160CEC873D18DEC677E0A391E17E7FA1EE7500EE3AF2DF12F13C2BCDBA8D9BD60ED432875F1093A2BBD135AE23EC52C543B53D4FD6262FA812DF1BEFA42F806EB39843BAE48D18EF28FD3BAE672FAC45197390C801C9649D3FA8E75ED7783411EEBBEA6F6CF704E3361400FF90AC5C203F6E36450ED94FE9E902818100C420072341BA87B1F76B505D26C12C812B2606020DF879EDF697894CC031E4F3A665B70BE017E25D5D7A348EB6DE9BDC2D8827AE3C1BBBBCCEBD9FF3AB2998ED9B57410CC1172FE259221F25FA18A98239A4D300372E76A6340BDFA987DEB85FEB784ED0AB1780189D81BABCCF330D186B0337E677A07A31EE04568326A04E2502818100B21D9EA1310BBA51D8CEB0163D444E42CE4C395C9012328E03B994C2545B7AE2B5E920EC8ED309532D8433B9068C9A86B4D56E92CB70629DF8C06E65D346DD576BBF50B7904406F766A2F7713805502CEC5EEEFD5580C7C95EB97F89CD8B20604B8F093BA81069E86773F905E600927519D1831BBC1EBD575BB1A773A9A6A5110281800A0981940257237EAE24E5D5FE97C0495405FC24BAC64EA729099453433ACA76D5BB3AE4F6B1023AB8FFFA149BB344D2BDD9CBFE14C16E983914674D372347DA512AE3FF5D1A6CAEEED4DA373D5769C56A61CF12A1C054FE2887BB08981583E614CCF16BA875E96E59113C97511B51BE402BC7FE997CB3043F2425B14C96C3A902818000C05E4255A606B356686EAE68DFB0B0138CCBA284A244FF43B5FBCEBC416D85259EAF48575408C1FBB4B9155E01A27F515B8D2A0AEA5B21960CC9F16FC36142C3279A08DB304449B743A9663AEA1807857473C21C740BE92188933965D7EBC0ED87CDAA0572FF3D41DB491CB09606B8FABCA644088CA7091044400DEB00529F")
